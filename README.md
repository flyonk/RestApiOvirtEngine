Инструкция по установке и использованию данного REST API сервиса созданного для оптимизации локализации oVirt Engine.

Данный REST API server создан для выгрузки из DOM-дерева платформы HOSTVM Virtualization (hostco.ru/ovirt.engine) всех слов (текстовых значений) на английском языке для их последующего помещения в базу данных bd.json в формате: ["English Text", "textForTranslate"]. В дальнейшем эта база данных используется для подмены "English Text" на "textForTranslate" в самой платформе, что фактически является переводом слов (локализацией платформы)

Данный сервер работает на платформе Node.JS и требует присутствия пакетного модуля npm.
Полный список необходимых технологий применяемых в этом сервисе выглядит так:
Node.JS, npm, Express.js, nodemon, express-handlebars.
Более полный список так же можно посмотреть в файле package.json в разделах "Dependencies".

Данный сервис можно развернуть как локально так и на виртуальной машине.

В первую очередь необходимо убедиться, что на целевом ПК установлен Node.JS
Скачать его можно здесь https://nodejs.org/en/ (подойдет любая версия из двух предложенных)
Если ранее NodeJS и npm не были установлены, необходимо открыть терминал и убедиться, что они присутвуют в системе. Сделать это можно при помощи команд node -v (для NodeJS) и npm -v (для npm, соответственно), если присутвуют обе технологии то будет показана их версия
Если npm отсутвует то необходимо его установить при помощи команды:
npm install npm@latest -g
Устанавливается он уже поверх установленного NodeJS

Теперь можно развертывать сам сервер.
Если Вы пользуетесь одним из современных редакторов кода (VSCode, PHPStorm, Atom и тп.) то удобнее будет открыть проект через Open File, и в них уже присутвутет встроенный терминал для работы с открытым проектом и мы будем работать в нём.
Далее Вы убедитесь, что для комфортной работы с данным API один из таких редакторов крайне желателен, хоть и не обязателен.
Тем не менее если такого редактора нет, то необходимо с помощью команд навигации терминала войти в корневую папку проекта.
Далее первым делом мы устанавливаем папку .node_modules с помощью команды "npm i"
В этой папке находятся все необходимые зависимости (технологии), для проекта, указанные выше.

По завершению загрузки node_modules сервер можно запускать, для этого используем команду "npm run devdemon" в терминале.
В консоль/терминал должно быть выведено сообщение, что сервер запущен на порту 3333, если да, то все идет успешно.

Теперь, например, можно открыть web-интерфейс данного приложения.
Если сервер развернут локально то его можно открыть по адресу http://localhost:3333 в браузере
Если сервер развернут на ВМ то его можно открыть по адресу http://название_машины:3333 , например у меня было так
http://t-dis-localstn.hostco.ru:3333/

На текущем этапе веб-интерфейса, назовем его 1.0, тут есть две опции:

1. на главной странице можно добавить уникальное значение в базу данных. (описание работы можно увидеть на самой странице)
2. просто посмотреть содержимое базы данных в удобном веб формате. в прочем его так же можно увидеть открыв базу данных db.json в папке data

В будущем возможно расширение функционала. Например возможность удалять, изменять данные и тп (предложения принимаются)

Я работал с в web-интерфейсом только в браузере Google Chrome. И в зависимости от локального/вм развертывания тут есть свой нюанс.

Если вы работаете локально, то перед переходом к главному функционалу, который будет описан далее, необходимо установить расширение
moesif origin & cors changer , скачать его можно тут:
https://chrome.google.com/webstore/detail/moesif-origin-cors-change/digfbfaphojjndkpccljibejjbppifbc
Оно изменяет политику безопасности CORS и разрешает отправлять POST запросы на локальный сервер.

Если вы работаете на ВМ, то запускать Google Chrome необходимо через cmd так:
C:\Program Files (x86)\Google\Chrome\Application\chrome.exe --allow-running-insecure-content (естественно если хром лежит по этой директории)
Это разрешает хрому отправлять запросы с миксованным контентом, коим и является большой массив, который скрипт будет отправлять на сервер и далее
распраршивать в bd.json

Если вы работаете с другим браузером то результат непредсказуем, либо все пройдет успешно и без доп действий, либо нет. В этом случае проверяйте ошибки в консоле разработчика в браузере, но уже потом, сначала нужно дойти до конца по инструкции.

Здесь с самим REST API сервером и функционалом его web-интерфейса мы закончили и переходим к клиентскому коду самого переводчика, который собственно и отправляет запрос, по пушу DOM-дерева в базу данных. Естественно это возможно только при включенном сервере.

Далее идет инструкция по работе с главным .js файлом нашего приложения, самим переводчиком, файл называется
translator.nocache.js
Он должен находится и я полагаю находится в директории нашего брэндирования
\ovirt-engine\brands\ovirt.brand\bundled

В продакшен режиме этот файл занимается переводом всего сайта (заменой русских слов на английские);
Что бы в базу данных выгружались необходимые нам английские слова, необходимо убедиться что этот функционал выключен.
Его вызывает одна главная функция ticker, которая находится сейчас на 181 строке кода, которая выглядит так ticker();
Для выключения необходимо закомментировать этот код выделив его и нажав Ctrl+/ в любом современном редакторе кода или поставив // перед этой строкой

Теперь когда весь сайт у нас на английском языке то мы можем выгружать элементы в нашу БД

За это отвечает код в этом же файле, который начинается со строки "function unique(arr) {" (сейчас это 189 строка)
и заканчивается строкой "}, 3333);" (сейчас это 261 строка)
Этот код необходимо раскомментировать (читай включить) при помощи Ctrl+/ выделив все эти строки в любом современном редакторе браузера
Ну или убрав // перед каждой строкой (сочувствую, ведь потом еще и обратно надо // добавить будет)
Будьте внимательны! Не надо выключать(комментировать) самую нижнию строчку кода "});" - иначе весь скрипт поломается

Теперь необходимо убедиться, что наша функция выгрузки делает запрос на сервер по корректному адресу.
Если вы запустили его локально, то это адрес "http://localhost:3333/postdom",
через Ctrl+F по запросу в файле ищем строку "await fetch" и убеждаемся, что после открывающейся скобки в кавычках идет именно этот адресс,
он находится в коде по дефолту.
Если вы работаете на ВМ, то этот адресс вы должны заменить на "http://название_машины:3333/postdom", точно так же как вы делали, когда
открывали веб-интерфейс сервера. Например у меня было "http://t-dis-localstn.hostco.ru:3333/postdom"

Теперь наш клиентский код полностью готов и мы приступаем к непосрдественной работе по выгрузке элементов в БД.

Мы заходим на наш портал и он будет выгружать раз в 3 секунды все необходимые элементы в базу данных.
Тут мы сталкиваемся с нюансом, вызванным особенностью движка ovirtEngine, DOM-елементы, которые у нас есть в большинстве своем
приходят динамически с его собственного сервера, а значит их нет сразу в DOM-дереве.
Что бы корректно выгрузить всё необходимо пробежаться (читай прокликаться) по каждой ссылке в меню навигации.
Открываем каждую ссылку, часть сайта, по очереди (сверху вниз, что бы не запутаться). В центре экрана каждой ссылки кликаем правой кнопкой мыши, потому что некоторые элементы приходят по событию контекстного меню, вызываемого райт кликом.
Так же помним, что выгрузка происходит раз в 3 секунды, то есть очень быстро переключаться по навигации не надо, а то скрипт не успеет выгрузить запрос.

Ваша задача планомерно пройтись по всем ссылкам бокового меню навигации, тратя на каждую около 5 сек и делать 1 райт клик в каждой ссылке.
На это не должно уйти больше 3х минут человеческого времени.
В конце можно убедиться, открыв файл bd.json в папке data на сервере или ссылку Смотреть БД в его веб интерфейсе (верхнем навбаре), что мы все добавили.

В последствии если будут найдены единичные не переведенные элементы их можно вручную добавить в веб-интерфейсе сервера на странице Главная.

После окончания работы необходимо обратно закоментировать весь код отвечающий за выгрузку. От строки "function unique(arr) {" до
"}, 3333);" и раскоментировать главную рабочую функцию ticker();

Вроде всё :)

Данный гайд, ориентирован, на человека, никогда не занимавшегося программированием и тем более веб-разработкой и может показаться избыточным, для любого джуна.
Сори если, что.
Если остануться вопросы, буду рад ответить. (Пётр Щепетин)
